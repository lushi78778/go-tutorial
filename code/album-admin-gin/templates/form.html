<!-- templates/form.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Album Form</title>
</head>
<body>
    <h1>{{ if .Album.ID }}Edit Album{{ else }}Add New Album{{ end }}</h1>

    <form id="albumForm">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" value="{{ .Album.Title }}" required><br>

        <label for="artist">Artist:</label>
        <input type="text" id="artist" name="artist" value="{{ .Album.Artist }}" required><br>

        <label for="price">Price:</label>
        <input type="number" id="price" name="price" value="{{ .Album.Price }}" step="0.01" required><br>

        <input type="submit" value="{{ if .Album.ID }}Update{{ else }}Add{{ end }}">
    </form>


    <br>
    <a href="/">Back to Albums</a>

    <script>
        document.getElementById("albumForm").addEventListener("submit", function(event) {
            event.preventDefault();
    
            // 构建 JSON 数据
            var formData = {
                title: document.getElementById("title").value,
                artist: document.getElementById("artist").value,
                price: parseFloat(document.getElementById("price").value),
            };
    
            // 根据编辑和添加操作发送不同的请求
            var url = "{{ if .Album.ID }}/edit/{{ .Album.ID }}{{ else }}/add{{ end }}";
            var method = "POST";
    
            // 发送请求
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                
                // 如果是添加操作，重定向到根路径
                if (!data.id) {
                    window.location.href = "/";
                }
    
                // 可以根据需要执行其他操作，例如显示成功消息
            })
            .catch(error => {
                console.error('Error:', error);
                // 处理错误，例如显示错误消息
            });
        });
    </script>
    
</body>
</html>
